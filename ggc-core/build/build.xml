<?xml version="1.0" ?>
<project name="GNU Gluco Control" default="build" basedir=".">
    <description>
        Build file for GGC
    </description>

    <!-- Environment properties read from a file ...-->
    <property file="../../build/AtechTools.properties"/>
    <property file="./GGCBuild.properties"/>
    <property file="./GGC_Core_Version.properties"/>
    

    <!-- These should *not* be modified on the command line! -->
    <property name="build.dir" value="${outdir.dir}/classes"/>
    <property name="deploy.dir" value="${outdir.dir}/deploy"/>
    
    
    <!-- Build GGC  -->
    
    <target name="build">
        <echo message="   ************************************************* "/>
        <echo message="   ****              GGC Core Build               **** "/>
        <echo message="   ************************************************* "/>
        <echo message=""/>
        <echo message="     copy = copies all needed files"/>
        <echo message="     clean = clean build dir"/>
        <echo message="     build_ggc (make) = build GGC (recompile classes)"/>
        <echo message="     jar = create GGC Core jar"/>
        <echo message="     jar_'part' = create specified GGC jar"/>
        <echo message="         available parts are: core, lang, little, main"/>
        <echo message="     jars_full = all jars"/>
        <echo message="     full = clean, build_ggc, copy, jars_full"/>
        <echo message="     deploy = full, copy files to main directory"/>
        <echo message="     dist = full, and create distribution zip file (contains needed libs, and data files)" />
        <echo message="     style (_devel, _deploy) = checkstyle against our rules" />
        <echo message=""/>
    </target>


    <!-- Public targets -->
        
    <target name="clean" description="Clean build directory and previus version of GGC">
        <delete dir="${build.dir}/ggc"/>
        <delete dir="${build.dir}/com"/>
        <delete dir="${build.dir}/org"/>
        <delete file="${build.dir}/ggc-core*.jar"/>
    </target>


    <target name="copy" description="Copy all needed files">
        <copy todir="${build.dir}/" overwrite="true">
            <fileset dir="${source.dir}" casesensitive="no">
                <include name="GGC_*.properties"/>
            </fileset>
        </copy>
    </target>




    <target name="make"  description="Build GGC">
        <javac srcdir="${source.dir}"
            destdir="${build.dir}"
            includes="ggc/**, org/**, com/**"
           deprecation="off" debug="true"> <!-- debug="${debug}    DummyHandler.java, ggc/db/HSQLHandler.java, ggc\db\MySQLHandler, ggc/db/TextFileHandler.java"  --> 
            
            <classpath>
                <pathelement path="${hibernate_cpath}" />
                <pathelement path="${utils_cpath}"/>
                <pathelement path="${classpath.full}"/>
             </classpath>
        </javac>
    </target>

     <target name="build_ggc"  description="Build GGC" />

<!--

           includes="ggc/**"
            excludes="ggc/db/**"  


-->



    <target name="jar_core"  description="Build GGC Core" depends="make">
        <jar jarfile="${binary.dir}/ggc-core-${ggc-core.version}.jar"
             update="false" 
             index="false"
             >

            <fileset dir="${build.dir}">
                <include name="ggc/core/**"/>
                <include name="*.hbm.xml"/>
                <exclude name="ggc/gui/**"/>
            </fileset>
            <fileset dir="${source.dir}">
                <include name="*.hbm.xml"/>
            </fileset>

        </jar>
    </target>


    <target name="jar_lang"  description="Build GGC Lang" depends="make">
        <jar jarfile="${binary.dir}/ggc-lang-${ggc-lang.version}.jar"
             update="false" 
             index="false"
             >

            <fileset dir="${build.dir}">
                <include name="ggc/core/**"/>
                <include name="GGC_*.properties"/>
                <include name="*.hbm.xml"/>
                <exclude name="ggc/core/**"/>
            </fileset>
            <fileset dir="${source.dir}/../data">
                <include name="help/**"/>
            	<include name="lang/**"/>
                <exclude name="**_svn/**"/>
                <exclude name="**/.svn/**"/>
            </fileset>
        </jar>
    </target>





    <target name="dev" depends="clean, copy, make">    
    </target>


    <target name="jars_full" depends="jar_core, jar_lang">    
    </target>


    <target name="full" depends="clean, copy, jars_full">    
    </target>

	
    <target name="deploy" depends="full">
        <copy file="${binary.dir}/ggc-core-${ggc-core.version}.jar" todir="../../build/deploy_files/"/>
        <copy file="${binary.dir}/ggc-lang-${ggc-lang.version}.jar" todir="../../build/deploy_files/"/>
    </target>
	
    <target name="deploy_old" depends="full">
    	<copy file="${binary.dir}/ggc-core-${ggc-core.version}.jar" todir="../../build/deploy_files/"/>
    	<copy file="${binary.dir}/ggc-main-${ggc-main.version}.jar" todir="../../build/deploy_files/"/>
    	<copy file="${binary.dir}/ggc-lang-${ggc-lang.version}.jar" todir="../../build/deploy_files/"/>
    	<copy file="${binary.dir}/ggc-little-${ggc-little.version}.jar" todir="../../build/deploy_files/"/>
    </target>
	
	
    <target name="dist">    
        <echo message="This option is not available yet." />
    </target>


    <target name="style_deploy">    
        <taskdef resource="checkstyletask.properties" classpath="${library.dir}/devel/checkstyle-all-4.1.jar" />

        <checkstyle config="ggc_deploy.xml">
            <fileset dir="${source.dir}" includes="**/*.java"/>

            <formatter type="plain"/>
            <formatter type="xml" toFile="checkstyle_errors.xml"/>
        </checkstyle>

    </target>

    <target name="style_devel">    
        <taskdef resource="checkstyletask.properties" classpath="${library.dir}/devel/checkstyle-all-4.1.jar" />

        <checkstyle config="ggc_devel.xml">
            <fileset dir="${source.dir}" includes="**/*.java"/>

            <formatter type="plain"/>
            <formatter type="xml" toFile="checkstyle_errors.xml"/>
        </checkstyle>
    </target>


    <target name="hbm2java" description="Generate .java from .hbm files." >
        <taskdef name="hbm2java"
            classname="net.sf.hibernate.tool.hbm2java.Hbm2JavaTask" 
            classpath="${hibernate.all.classpath.dir}"/>
            <hbm2java output="${source.dir}/hib_new/" >
                <fileset dir="${source.dir}">
                    <include name="**/*.hbm.xml"/>
                </fileset>
            </hbm2java>
    </target>


</project>

